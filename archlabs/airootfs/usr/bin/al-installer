#!/usr/bin/env bash


[[ -e /run/archiso/bootmnt && $TERM == "linux" ]] && setfont ter-116n

while ! ping -c 1 www.github.com &>/dev/null; do
    bt=" Archlabs Installer "
    ttl=" Network Check "
    msg="\nNo network connection detected!"

    if [[ $(systemctl is-active NetworkManager) == "active" ]]; then
        msg="$msg\n\nOpen Connection Dialog?\n\n"
        dialog --backtitle "$bt" --title "$ttl" --yesno "$msg" 0 0 && nmtui || break
    else
        dialog --backtitle "$bt" --title "$ttl" \
            --infobox "$msg\n\nYou may experience issues without a network connection...\n\n" 0 0
        sleep 2
        break
    fi
done

# check if any updates for installer are available
if sudo pacman -Sy && pacman -Qqu "archlabs-installer" &>/dev/null; then
    clear
    echo -e "\nUpdating the installer... Please Wait\n"
    sudo pacman -S archlabs-installer --noconfirm 2>/dev/null
fi

clear
echo -e "\nLaunching the installer...\n"
sleep 1
TERM='xterm-256color' sudo /installer/installer
