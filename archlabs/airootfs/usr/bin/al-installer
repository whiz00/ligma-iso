#!/usr/bin/env bash

# simple wrapper script to update and launch the installer
# located at /installer/installer

[[ -e /run/archiso/bootmnt && $TERM == "linux" ]] && setfont ter-116n

if ! (ping -c 1 archlabslinux.com || ping -c 1 google.com || ping -c 1 bitbucket.org) &>/dev/null; then
    if ! (ping -c 1 github.com || ping -c 1 sourceforge.net) &>/dev/null; then
        bt=" Archlabs Installer "
        msg="\nNo network connection detected!"
        if [[ $(systemctl is-active NetworkManager) == "active" ]]; then
            hash nmtui &>/dev/null && nmtui
        else
            dialog --backtitle "$bt" --title " Network Check " --infobox \
                "$msg\n\nYou may experience issues without a network connection...\n\n" 0 0
            sleep 2
        fi

        clear
    fi
fi

# check if any updates for installer are available
if sudo pacman -Syy && pacman -Qqu "archlabs-installer" &>/dev/null; then
    echo -e "\nUpdating installer... Please Wait\n"
    sudo pacman -S archlabs-installer --noconfirm 2>/dev/null
fi

clear
echo -e "\nLaunching installer...\n"

sudo /installer/installer $@
