#!/usr/bin/env bash


[[ -e /run/archiso/bootmnt && $TERM == "linux" ]] && setfont ter-116n

while ! (ping -c 1 archlabslinux.com &>/dev/null || ping -c 1 bitbucket.org &>/dev/null || ping -c 1 github.com &>/dev/null); do
    bt=" Archlabs Installer "
    ttl=" Network Check "
    msg="\nNo network connection detected!"

    if [[ $(systemctl is-active NetworkManager) == "active" ]]; then
        msg="$msg\n\nOpen a connection dialog?\n\n"
        dialog --backtitle "$bt" --title "$ttl" --yesno "$msg" 0 0 && nmtui
        clear
        break
    else
        dialog --backtitle "$bt" --title "$ttl" --infobox "$msg\n\nYou may experience issues without a network connection...\n\n" 0 0
        sleep 2
        clear
        break
    fi
done

# check if any updates for installer are available
if sudo pacman -Syy && pacman -Qqu "archlabs-installer" &>/dev/null; then
    echo -e "\nUpdating installer... Please Wait\n"
    sudo pacman -S archlabs-installer --noconfirm 2>/dev/null
fi

clear
echo -e "\nLaunching installer...\n"

TERM='xterm-256color' sudo /installer/installer
